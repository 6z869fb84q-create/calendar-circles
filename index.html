<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Shift Calendar</title>

<style>
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Arial;background:#111;color:#fff}
  header{display:flex;justify-content:space-between;align-items:center;padding:12px;gap:10px}
  button{background:#222;border:1px solid #333;color:#fff;border-radius:12px;padding:10px 14px;font-size:16px}
  #title{font-weight:800;text-align:center;flex:1;font-size:16px;opacity:.95}

  .dow{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:0 12px 10px}
  .dow div{text-align:center;font-size:12px;opacity:.75;letter-spacing:.4px}

  .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:0 12px 12px}
  .day{
    height:78px;border-radius:16px;background:#1a1a1a;position:relative;
    padding:8px;overflow:hidden;
    user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;
    touch-action:manipulation;
  }
  .num{font-size:14px;font-weight:700;opacity:.95}
  .dot{width:16px;height:16px;border-radius:50%;position:absolute;bottom:8px;left:8px}
  .label{
    position:absolute;left:34px;right:8px;bottom:7px;
    font-size:13px;font-weight:600;opacity:.9;
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;
    overflow:hidden;line-height:1.15;
  }
  .hint{padding:0 12px 14px;font-size:12px;opacity:.75;line-height:1.35}
</style>
</head>

<body>

<header>
  <button onclick="prev()">◀</button>
  <div id="title"></div>
  <button onclick="next()">▶</button>
</header>

<div class="dow" id="dow"></div>
<div class="grid" id="grid"></div>

<div class="hint">
Tap = colour • Hold = add/edit text • Hold longer = clear
</div>

<script>
const colors=["#ff3b30","#34c759","#0a84ff","#ffd60a","#bf5af2"];
let now=new Date();
let data=JSON.parse(localStorage.getItem("days")||"{}");

function key(d){return d.toISOString().slice(0,10)}

function renderDOW(){
  const labels=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  const dow=document.getElementById("dow");
  dow.innerHTML="";
  for(const l of labels){
    const el=document.createElement("div");
    el.textContent=l;
    dow.appendChild(el);
  }
}

function editText(k){
  const current = (data[k] && data[k].text) ? data[k].text : "";
  const t = prompt("Shift text (e.g. 2am–10pm):", current);
  if(t!==null){
    data[k]=data[k]||{};
    const trimmed = t.trim();
    if(trimmed===""){
      delete data[k].text; // allow blank to remove text
    } else {
      data[k].text=trimmed;
    }
    localStorage.setItem("days",JSON.stringify(data));
    render();
  }
}

function clearDay(k){
  delete data[k];
  localStorage.setItem("days",JSON.stringify(data));
  render();
}

function render(){
  document.getElementById("title").innerText=
    now.toLocaleString("default",{month:"long",year:"numeric"});

  let first=new Date(now.getFullYear(),now.getMonth(),1);
  let start=new Date(first);
  start.setDate(first.getDate()-((first.getDay()+6)%7)); // Monday start

  let g=document.getElementById("grid");
  g.innerHTML="";

  for(let i=0;i<42;i++){
    let d=new Date(start);
    d.setDate(start.getDate()+i);
    let k=key(d);

    let cell=document.createElement("div");
    cell.className="day";
    cell.innerHTML=`<div class="num">${d.getDate()}</div>`;

    if(data[k]){
      if(data[k].color!=null){
        let dot=document.createElement("div");
        dot.className="dot";
        dot.style.background=colors[data[k].color];
        cell.appendChild(dot);
      }
      if(data[k].text){
        let label=document.createElement("div");
        label.className="label";
        label.textContent=data[k].text;
        cell.appendChild(label);
      }
    }

    // TAP = cycle colour
    cell.addEventListener("click", ()=>{
      data[k]=data[k]||{};
      data[k].color=(data[k].color+1||0)%colors.length;
      localStorage.setItem("days",JSON.stringify(data));
      render();
    });

    // HOLD logic:
    //  - 450ms hold: edit text
    //  - 900ms hold: clear day
    let pressTimer1=null, pressTimer2=null;
    cell.addEventListener("touchstart", (e)=>{
      // Prevent iOS gestures from interfering
      // (don’t call preventDefault on passive listeners; we set passive:false)
      pressTimer1=setTimeout(()=>editText(k), 450);
      pressTimer2=setTimeout(()=>clearDay(k), 900);
    }, {passive:false});

    cell.addEventListener("touchend", ()=>{
      if(pressTimer1) clearTimeout(pressTimer1);
      if(pressTimer2) clearTimeout(pressTimer2);
    });

    cell.addEventListener("touchmove", ()=>{
      if(pressTimer1) clearTimeout(pressTimer1);
      if(pressTimer2) clearTimeout(pressTimer2);
    });

    g.appendChild(cell);
  }
}

renderDOW();
render();
function prev(){now.setMonth(now.getMonth()-1);render();}
function next(){now.setMonth(now.getMonth()+1);render();}
</script>

</body>
</html>
